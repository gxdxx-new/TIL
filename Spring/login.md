## 세션 기반 인증 방식과 토큰 기반 인증 방식 (JWT)

- #### 웹 서버는 Stateless 프로토콜인 HTTP를 사용하기 때문에 웹사이트에서 인증을 관리하기 위한 방안이 필요하다.
- #### 로그인을 한 유저들에 대해 권한이 필요한 매 요청마다 재로그인을 시킬 수 없기 때문에,
- #### 웹사이트는 유저의 접속 정보를 관리하기 위한 몇가지 방안을 사용한다.

## 1. 세션 기반 인증 방식

• 세션 기반 인증을 위해 Session과 Cookie가 사용된다.

• 유저가 로그인을 하고 세션이 서버 메모리 상에 저장된다. 이 때 **세션을 식별하기 위한 Session Id를 기준으로 정보를 저장**한다.

• 서버가 클라이언트에 Session Id를 전달해 **클라이언트의 브라우저에 쿠키로 Session Id가 저장**된다.

• 쿠키에 정보가 담겨있기 때문에 **브라우저는 해당 사이트에 대한 모든 Request에 Session Id를 쿠키에 담아 전송**한다.

• **서버는 클라이언트가 보낸 Session Id와 서버 메모리로 관리하고 있는 Session Id를 비교**해 Verification 을 수행한다.

### 장점

• 서버측에서 관리하기 때문에 **클라이언트 변조에 영향받거나 데이터의 손상 우려가 없다**.

### 단점

• 세션 데이터가 서버의 메모리에 저장되므로, 확장 시 모든 서버가 접근할 수 있도록 별도의 중앙 세션 관리 시스템이 필요하다.

• 중앙 세션 관리 시스템이 없으면, 시스템 확장에 어려움이 생긴다.

• 중앙 세션 관리 시스템에 장애가 발생하면, 시스템 전체에 문제가 발생한다.

• 메모리에 세션 정보가 들어있으면, **메모리가 유저들의 세션에 대한 정보를 서버 메모리에 들고 있게 된다는 부담**이 있다.

• 멀티 디바이스 환경에서 로그인 시 신경써줘야할 부분들이 생긴다.

---

## 2. 토큰 기반 인증 방식 JWT(Json Web Token)

• 클라이언트의 세션 상태를 저장하는게 아니라, **필요한 정보를 토큰 body에 저장해 클라이언트가 가지고 있고 그것을 증명서처럼 사용**한다.

• 많은 웹 서버에서 토큰 기반 인증 방식 중 하나인 JWT(Json Web Token)을 사용한다.

• Token 기반 인증 방식과 Session 기반 인증 방식의 가장 큰 차이점은 **유저의 정보가 서버에 저장되지 않는다는 점**이다.

• Session 기반 서버가 서버측에 정보를 기록하는 반면,

• Token 기반 인증은 Token에 대한 Verification만 수행할 뿐 저장은 클라이언트에서 수행한다.

### 토큰 기반 인증 방식 절차

1. 유저가 로그인을 하고 서버에 세션을 이용해서 정보를 기록하는대신, Token을 발급한다.
2. 클라이언트는 발급된 Token을 저장한다 (일반적으로 local storage에 저장한다.)
3. **클라이언트는 요청 시 저장된 Token을 Header에 포함시켜 보낸다**.
4. 서버는 매 요청시 클라이언트로부터 전달받은 Header의 Token 정보를 Verification한 뒤, 해당 유저에 권한을 인가한다.

### 장점

• 클라이언트에 저장되기 때문에 서버의 메모리에 부담이 되지않는다.
• 멀티 디바이스 환경에 대한 부담이 없다.

### 단점

• 상대적으로 **손상의 위험**이 크다.

• 구현을 하다보면 서버측에 token blacklist를 관리하게 될 가능성이 있고 그렇게 되면 서버측 메모리의 소모가 발생하게 된다

• Token은 일반적으로 Session ID 보다 길다.

• **XSS 공격에 취약**할 수 있어 가능한 민감한 정보는 포함시키지 않을 필요가 있다.

• 클라이언트가 계속 시스템을 이용하다가 access 토큰 기한이 만료된다면 사용중에 갑자기 로그인을 하라고 할 것이다.

• 수명이 짧다면 만료될 때마다 로그인 해주어야 한다.

• 수명이 길면 해커에게 해독되어 사용될 가능성이 높아진다.